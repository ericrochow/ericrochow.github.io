
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://ericroc.how/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://ericroc.how/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="https://ericroc.how/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://ericroc.how/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://ericroc.how/theme/font-awesome/css/solid.css">





<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-135617138-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

<meta name="author" content="Eric Rochow" />
<meta name="description" content="An overview of fabric extenders" />
<meta name="keywords" content="network, nx-os, fex">

<meta property="og:site_name" content="Eric Rochow"/>
<meta property="og:title" content="Fabric Extender (FEX)"/>
<meta property="og:description" content="An overview of fabric extenders"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://ericroc.how/fabric-extender-fex.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2017-02-24 12:11:00-05:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://ericroc.how/author/eric-rochow.html">
<meta property="article:section" content="Network"/>
<meta property="article:tag" content="network"/>
<meta property="article:tag" content="nx-os"/>
<meta property="article:tag" content="fex"/>
<meta property="og:image" content="https://ericroc.how/images/face.png">

  <title>Eric Rochow &ndash; Fabric Extender (FEX)</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://ericroc.how">
        <img src="https://ericroc.how/images/face.png" alt="Eric Rochow" title="Eric Rochow">
      </a>
      <h1><a href="https://ericroc.how">Eric Rochow</a></h1>


      <nav>
        <ul class="list">
          <li><a href="https://ericroc.how/pages/about-me.html#about-me">About Me</a></li>
          <li><a href="https://ericroc.how/pages/read-with-me.html#read-with-me">Read With Me</a></li>

          <li><a href="http://resume.ericroc.how" target="_blank">Resume</a></li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-globe" href="https://ericroc.how" target="_blank">
            <i class="fab fa-globe">
            </i>
          </a></li>
          <li>
            <a  class="sc-envelope" href="mailto:ericrochow@gmail.com" target="_blank">
            <i class="fas fa-envelope">
            </i>
          </a></li>
          <li>
            <a  class="sc-fas fa-rss" href="https://ericroc.how" target="_blank">
            <i class="fab fa-fas fa-rss">
            </i>
          </a></li>
          <li>
            <a  class="sc-fab fa-linkedin" href="https://www.linkedin.com/in/erochow/" target="_blank">
            <i class="fab fa-fab fa-linkedin">
            </i>
          </a></li>
          <li>
            <a  class="sc-fab fa-github" href="https://github.com/ericrochow" target="_blank">
            <i class="fab fa-fab fa-github">
            </i>
          </a></li>
          <li>
            <a  class="sc-fab fa-twitter" href="https://twitter.com/eric_rochow" target="_blank">
            <i class="fab fa-fab fa-twitter">
            </i>
          </a></li>
          <li>
            <a  class="sc-fab fa-lastfm" href="https://www.last.fm/user/ericrochow" target="_blank">
            <i class="fab fa-fab fa-lastfm">
            </i>
          </a></li>
          <li>
            <a  class="sc-fab fa-spotify" href="https://open.spotify.com/user/ericrochow?si=KEmxAAk8QZy31L82MMge4g" target="_blank">
            <i class="fab fa-fab fa-spotify">
            </i>
          </a></li>
          <li>
            <a  class="sc-fas fa-book" href="https://www.goodreads.com/user/show/18841479-eric-rochow" target="_blank">
            <i class="fab fa-fas fa-book">
            </i>
          </a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://ericroc.how">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>


    </nav>

<article class="single">
  <header>
      
    <h1 id="fabric-extender-fex">Fabric Extender (FEX)</h1>
    <p>
          Posted on Fri 24 February 2017 in <a href="https://ericroc.how/category/network.html">Network</a>


    </p>
  </header>


  <div>
    <h1>Fabric Extender (FEX)</h1>
<h2>Overview</h2>
<p>The Cisco Nexus 2000 line of switches are known as Fabic Extenders (or FEXes). Fabric extenders act as remote line cards that are controlled by aggregation switches. The FEX is assigned an ID betweeen 100 and 199 and the FEX shows up as being in that slot. As of writing the Nexus 5000-, 6000-, 7000-, and 9000-series switches are capable of aggregating FEXes.</p>
<p>It is possible to dual-home a FEX to a pair of aggregation switches and have the configuration of the FEX synchronized between the two aggregation switches.</p>
<h2>Base Configuration</h2>
<p>On the aggregation switch, enter the following configuration:</p>
<div class="highlight"><pre><span></span><span class="err">agg-sw01(config)# feature fex</span>
<span class="err">agg-sw01(config)# interface e1/1</span>
<span class="err">agg-sw01(config-if)# channel-group 101</span>
<span class="err">agg-sw01(config)# interface po101</span>
<span class="err">agg-sw01(config-if)# switchport mode fex-fabric</span>
<span class="err">agg-sw01(config-if)# fex associate 101</span>
</pre></div>


<p>At this point the connected FEX should upgrade its software to match that of the aggregation switch and reboot. The interfaces on the FEX should show up on the aggregation switch as soon as the reboot completes.</p>
<h2>Dual-Homing Configuration</h2>
<h3>Configure CFS for FEX Config Sync</h3>
<p>Since we will be using multiple aggregation switches to manage a single device, we will need to configure CFS distribution to distribute the config changes to the sister device:</p>
<div class="highlight"><pre><span></span><span class="n">agg</span><span class="o">-</span><span class="n">sw01</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">#</span> <span class="n">cfs</span> <span class="n">ipv4</span> <span class="n">distribute</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw01</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">#</span> <span class="k">end</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw01</span><span class="o">#</span> <span class="n">configure</span> <span class="n">sync</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw01</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">sync</span><span class="p">)</span><span class="o">#</span> <span class="n">switch</span><span class="o">-</span><span class="n">profile</span> <span class="n">PROFILE</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw01</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">sync</span><span class="p">)</span><span class="o">#</span> <span class="n">sync</span><span class="o">-</span><span class="n">peers</span> <span class="n">destination</span> <span class="mi">10</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">y</span><span class="p">.</span><span class="mi">2</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw01</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">sync</span><span class="p">)</span><span class="o">#</span> <span class="k">end</span>

<span class="n">agg</span><span class="o">-</span><span class="n">sw02</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">#</span> <span class="n">cfs</span> <span class="n">ipv4</span> <span class="n">distribute</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw02</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">#</span> <span class="k">end</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw02</span><span class="o">#</span> <span class="n">configure</span> <span class="n">sync</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw02</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">sync</span><span class="p">)</span><span class="o">#</span> <span class="n">switch</span><span class="o">-</span><span class="n">profile</span> <span class="n">PROFILE</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw02</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">sync</span><span class="p">)</span><span class="o">#</span> <span class="n">sync</span><span class="o">-</span><span class="n">peers</span> <span class="n">destination</span> <span class="mi">10</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">y</span><span class="p">.</span><span class="mi">1</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw02</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">sync</span><span class="p">)</span><span class="o">#</span> <span class="k">end</span>
</pre></div>


<h3>Configure FEX Fabric Interfaces</h3>
<p>Configuration of dual-homed FEXes is similar to single-homed FEXes with a few extra steps. Assuming the two aggregation switches have been configured as a vPC pair, the following configuration is required on the first aggregation switch:</p>
<div class="highlight"><pre><span></span><span class="err">agg-sw01(config)# feature fex</span>
<span class="err">agg-sw01(config)# interface e1/1</span>
<span class="err">agg-sw01(config-if)# channel-group 101</span>
<span class="err">agg-sw01(config)# interface po101</span>
<span class="err">agg-sw01(config-if)# vpc 101</span>
<span class="err">agg-sw01(config-if)# switchport mode fex-fabric</span>
<span class="err">agg-sw01(config-if)# fex associate 101</span>
</pre></div>


<p>Next, configure the following on the second aggregation switch:</p>
<div class="highlight"><pre><span></span><span class="err">agg-sw02(config)# feature fex</span>
<span class="err">agg-sw02(config)# interface e1/1</span>
<span class="err">agg-sw02(config-if)# channel-group 101</span>
<span class="err">agg-sw02(config)# interface po101</span>
<span class="err">agg-sw02(config-if)# vpc 101</span>
<span class="err">agg-sw02(config-if)# switchport mode fex-fabric</span>
<span class="err">agg-sw02(config-if)# fex associate 101</span>
</pre></div>


<p>Before connecting the FEX to either aggregation switch, we will want to pre-provision the slot as the FEX configuration cannot be synced to the other switch if the configuration does not already exist.</p>
<h3>Preprovisioning Fabric Extenders</h3>
<div class="highlight"><pre><span></span><span class="n">agg</span><span class="o">-</span><span class="n">sw01</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">#</span> <span class="n">slot</span> <span class="mi">101</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw01</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">slot</span><span class="p">)</span><span class="o">#</span> <span class="n">provision</span> <span class="n">model</span> <span class="n">n2k</span><span class="o">-</span><span class="n">n2348tq</span>

<span class="n">agg</span><span class="o">-</span><span class="n">sw02</span><span class="p">(</span><span class="n">config</span><span class="p">)</span><span class="o">#</span> <span class="n">slot</span> <span class="mi">101</span>
<span class="n">agg</span><span class="o">-</span><span class="n">sw02</span><span class="p">(</span><span class="n">config</span><span class="o">-</span><span class="n">slot</span><span class="p">)</span><span class="o">#</span> <span class="n">provision</span> <span class="n">model</span> <span class="n">n2k</span><span class="o">-</span><span class="n">n2348tq</span>
</pre></div>


<h3>Distributing Config Changes</h3>
<p>To keep changes consistent between the pair of aggregation switches, make sure that changes are configured using the CFS profile configured ealier rather than in standard config mode:</p>
<div class="highlight"><pre><span></span><span class="err">agg-sw01# config sync</span>
<span class="err">agg-sw01(config-sync)# switch-profile PROFILE</span>
<span class="err">agg-sw01(config-sync-sp)# interface e101/1/1</span>
<span class="err">agg-sw01(config-sync-sp-if)# desc Server1</span>
<span class="err">agg-sw01(config-sync-sp-if)# switchport mode access</span>
<span class="err">agg-sw01(config-sync-sp-if)# switchport access vlan 55</span>
<span class="err">agg-sw01(config-sync-sp-if)# no shutdown</span>
<span class="err">agg-sw01(config-sync-sp-if)# exit</span>
</pre></div>


<p>The configuration has not taken effect yet, but before the configuration is configured, it should be verified to make sure there are not inconsistencies:</p>
<div class="highlight"><pre><span></span><span class="err">agg-sw01(config-sync-sp)# verify</span>
<span class="err">Verification Successful</span>
</pre></div>


<p>If the verification is not successful, then some troubleshooting steps will need to be taken. Otherwise, it is time to commit the changes.</p>
<div class="highlight"><pre><span></span><span class="err">agg-sw01(config-sync-sp)# commit</span>
<span class="err">Verification successful...</span>
<span class="err">Proceeding to apply configuration. This might take a while depending on amount of configuration in buffer.</span>
<span class="err">Please avoid other configuration changes during this time.</span>
<span class="err">Commit Successful</span>
</pre></div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://ericroc.how/tag/network.html">network</a>
      <a href="https://ericroc.how/tag/nx-os.html">nx-os</a>
      <a href="https://ericroc.how/tag/fex.html">fex</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy; Eric Rochow 2019</p>
    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Eric Rochow ",
  "url" : "https://ericroc.how",
  "image": "https://ericroc.how/images/face.png",
  "description": ""
}
</script>

</body>
</html>